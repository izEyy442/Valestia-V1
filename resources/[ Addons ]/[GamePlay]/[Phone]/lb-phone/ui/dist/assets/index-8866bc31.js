var V=Object.defineProperty;var w=(n,o,r)=>o in n?V(n,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[o]=r;var E=(n,o,r)=>(w(n,typeof o!="symbol"?o+"":o,r),r);import{r as f,j as v,R as C,F as x,a as R}from"./jsx-runtime-f40812bf.js";import{r as $}from"./index-0dd4a6fb.js";import{f as p,d as s,u as g,$ as S,P as b,a as k}from"./Phone-4e9b2e8a.js";import"./number-28525126.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();var y={},N=$;y.createRoot=N.createRoot,y.hydrateRoot=N.hydrateRoot;const L=()=>{const[n,o]=f.useState(null);return f.useEffect(()=>{p("voice:getConfig").then(r=>{if(!r)return s("error","VoiceProvider: No config found");o(r)})},[]),n!=null&&n.recordNearbyVoices?v(M,{config:n}):null},M=({config:n})=>{const o=f.useRef(null),[r,u]=f.useState([]),[t,i]=f.useState(!0),m=()=>new Promise((e,c)=>{var a;if(o.current)return e(o.current);(a=navigator.mediaDevices)==null||a.getUserMedia({audio:{autoGainControl:!1,noiseSuppression:!1,echoCancellation:!1}}).then(l=>{s("info","VoiceProvider: Got audio stream"),o.current=l,p("isTalking").then(d=>{i(!d)}),e(l)})});return f.useEffect(()=>{if(!o.current)return s("warning","VoiceProvider: No audio stream");s("info",`VoiceProvider: ${t?"muting":"umuting"} audio stream`),r.forEach(e=>{e.gainNode.gain.value=t?0:e.volume,s("info",`VoiceProvider: Set volume to ${t?0:e.volume} for channel ${e.id}`)})},[t]),g("camera:toggleMicrophone",e=>{i(!e)}),f.useEffect(()=>{var e;r.length===0&&((e=o.current)==null||e.getTracks().forEach(c=>c.stop()),o.current=null,s("info","VoiceProvider: Stopped audio stream"))},[r]),g("voice:joinChannel",async e=>{if(await m(),!o.current)return s("warning","VoiceProvider: No audio stream");if(r.find(h=>h.id===e.channel))return s("warning","VoiceProvider: Already connected to channel "+e.channel);s("info","Joining voice channel "+JSON.stringify(e));let c=new AudioContext,a=c.createMediaStreamSource(o.current),l=c.createMediaStreamDestination(),d=c.createGain();d.gain.value=e.volume,a.connect(d),d.connect(l),p("isTalking").then(h=>{h||(d.gain.value=0)});const P=n!=null&&n.ice?new S({config:{iceTransportPolicy:"relay",iceServers:n==null?void 0:n.ice}}):new S;P.on("open",()=>{P.call(e.channel,l.stream),u(h=>[...h,{id:e.channel,volume:e.volume,peer:P,gainNode:d,audioCtx:c}])})}),g("voice:leaveChannel",e=>{s("info","Leaving voice channel "+e);const c=r.find(a=>a.id===e);if(!c)return s("warning","VoiceProvider: Not connected to channel "+e);c.audioCtx.close(),c.peer.destroy(),u(a=>a.filter(l=>l.id!==e))}),g("voice:setVolume",e=>{s("info","Setting volume for channel "+e.channel+" to "+e.volume);const c=r.find(a=>a.id===e.channel);if(!c)return s("warning","VoiceProvider: Not connected to channel "+e.channel);t?s("info","VoiceProvider: Not setting volume because mic is muted"):c.gainNode.gain.value=e.volume,u(a=>a.map(l=>l.id===e.channel?{...l,volume:e.volume}:l))}),null};class j extends C.Component{constructor(){super(...arguments);E(this,"state",{hasError:!1})}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,u){this.logError(r,u)}logError(r,u){console.error("Phone crashed:",r,u),p("logError",{error:r.message,stack:r.stack,componentStack:u.componentStack})}render(){return this.state.hasError?(window.location.reload(),null):this.props.children}}y.createRoot(document.getElementById("root")).render(v(x,{children:R(j,{children:[v(b,{children:v(k,{})}),v(L,{})]})}));
