import{r as s,a,j as e,F as Y}from"./jsx-runtime-f40812bf.js";import{s as Me,b as se,$ as we,d as H,aD as Ue,f as N,S as me,u as Z,C as z,L as n,X as re,ba as De,H as ve,bA as Oe,k as te,h as Pe,J as Se,c as oe,W as ae,N as xe,a1 as ge,F as We,aB as he,bB as ke,G as ne,v as ie,ab as Ge,I as Ne,x as Ae,aN as ye,aa as le,ae as Ve,ag as qe,ap as He,bC as Be,bD as $e,a3 as Te,a4 as Le,ax as je,bE as Ye,bx as ze,E as Xe,aI as Ke}from"./Phone-4e9b2e8a.js";import{r as Je}from"./number-28525126.js";import{C as Qe}from"./Check-0b024d45.js";import{formatNumber as Ze}from"./Tiktok-8ccf5909.js";import"./Slider-05e4dc2b.js";const ee=Me({host:"",participants:[],viewers:0});function et(){var B,Q,ce,ue;const{View:i,Account:f,Func:E}=s.useContext(X),[o,A]=i,[d]=f,m=se(Pe),u=se(ee),[P,C]=s.useState(!1),[l,t]=s.useState(!1),[S,p]=s.useState(null),[G,h]=s.useState(""),I=s.useRef(null),M=s.useRef(null),_=s.useRef(null),[F,T]=s.useState(null),[k,y]=s.useState(null),[D,x]=s.useState(null),[r,c]=s.useState([]),[w,R]=s.useState([]),[g,U]=s.useState([]);s.useEffect(()=>{I.current.scrollTop=I.current.scrollHeight},[g]),s.useEffect(()=>{const L=m.ice?new we({config:{iceTransportPolicy:"relay",iceServers:m.ice}}):new we;return L.on("open",v=>{T({peer:L,id:v})}),L.on("call",v=>{v.on("close",()=>{R(V=>V.filter(W=>W.connectionId!==v.connectionId))}),R(V=>[...V,v])}),H("info","Created peer"),()=>{try{for(let v of w)v.close()}catch{H("error","Failed to close calls")}try{L.destroy()}catch{H("error","Failed to destroy peer")}}},[]),s.useEffect(()=>{if(!D||_!=null&&_.current||!F)return;H("info","Creating game render");let L=new Ue(D);_.current=L,L.resizeByAspect(3/4);const v=window.innerWidth;v>1280&&L.setQuality(1280/v);let V;if(k||P){H("info","Host is true, creating call"),P?N("Instagram",{action:"setLive",username:d.username,verified:d.verified,id:F.id}):k&&N("Instagram",{action:"joinLive",username:k,streamId:F.id}).then(j=>{if(y(null),!j)return H("error","Failed to join live");t(!0)});const W=D.captureStream(24);V=j=>{H("info","Answering call",j),j.answer(W)},F.peer.on("call",V)}return()=>{V&&F.peer.off("call",V),_.current&&_.current.destroy(),_.current=null}},[D,F]);const O=L=>{L.forEach(v=>{if(v.username===d.username)return H("info","Skipping self");H("info","Adding participant",v);const V=document.createElement("canvas"),W=V.captureStream(0),j=F.peer.call(v.id,W);R(J=>[...J,j]),j.on("close",V.remove),j.on("error",V.remove),j.on("stream",J=>{N("Instagram",{action:"addCall",id:j.connectionId,username:v.username}),c(fe=>[...fe,{stream:J,username:v.username}])})})},$=L=>{L.forEach(v=>{H("info","Removing participant",v),v.username===d.username&&t(!1),c(V=>V.filter(W=>W.username!==v.username))})};s.useEffect(()=>{const L=u.participants;if(!L||!F)return H("warning","No participants");const v=L.filter(W=>!r.find(j=>j.username===W.username));v.length&&O(v),H("info","Added",v);const V=r.filter(W=>!L.find(j=>j.username===W.username));V.length&&$(V),H("info","Removed",V)},[u.participants,F]),s.useEffect(()=>{const L=d.username===(u==null?void 0:u.host);if(C(L),me.ShouldClose.set(!1),!!L)return c(v=>[...v,{username:u.host}]),()=>{me.ShouldClose.set(!0)}},[]);const q=()=>{z.PopUp.set({title:P?n("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(P?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE")).toLowerCase()}),buttons:[{title:n("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:P?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{b(P)}}]})},K=()=>{N("Instagram",{action:"sendLiveMessage",data:{user:{username:d.username,avatar:d.avatar,verified:d.verified},live:u.host,content:G}}),h("")},b=(L,v)=>{if(P)N("Instagram",{action:"endLive"}).then(()=>{A("feed")});else if(l&&N("Instagram",{action:"endLive"}).then(()=>{A("feed")}),N("Instagram",{action:"stopViewing",username:u.host}),L)me.ShouldClose.set(!0),ee.patch({ended:!0});else{if(v===!1)return;A("feed")}};return Z("instagram:addMessage",L=>{L.live===u.host&&U(v=>[...v,L])}),Z("instagram:updateViewers",L=>{L.username===(u==null?void 0:u.host)&&ee.patch({viewers:L.viewers})}),Z("instagram:setLive",L=>{ee.set(L)}),Z("instagram:liveEnded",L=>{L===(u==null?void 0:u.host)&&b(!0)}),Z("instagram:stopLive",()=>A("feed")),Z("instagram:endCall",L=>{const v=w.find(V=>V.connectionId===L);v&&(v.close(),R(V=>V.filter(W=>W.connectionId!==L)))}),Z("instagram:invitedLive",L=>{L===(u==null?void 0:u.host)&&z.PopUp.set({title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:L}),buttons:[{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{y(L),c(v=>[...v,{username:d.username}])}}]})}),Z("instagram:joinedLive",L=>{L.host===(u==null?void 0:u.host)&&ee.patch({participants:[...u.participants,L]})}),Z("instagram:leftLive",L=>{L.host===(u==null?void 0:u.host)&&(H("info","left live",L),ee.patch({participants:u.participants.filter(v=>v.username!==L.participant)}))}),a("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":r.length.toString(),children:r.map((L,v)=>L.username===d.username?a("div",{className:"instagram-stream",children:[e("canvas",{ref:V=>{H("info","setting canvas ref",V),x(V)}}),!P&&e(re,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{N("Instagram",{action:"endLive"}),t(!1)}}]})}})]}):e(tt,{host:P,stream:L.stream,username:L.username},`stream-${v}`))}),u.ended&&a("div",{className:"instagram-stream-ended",children:[e(De,{onClick:()=>A("feed")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(ve,{children:S&&e(st,{username:u.host,type:S,host:S==="participants"?P||l:P,endLive:b,close:()=>p(null)})}),a("div",{className:"instagram-live",children:[a("div",{className:"live-header",children:[a("div",{className:"profile",onClick:()=>{r.length>1?p("participants"):!P&&!l&&(b(),E.fetchAndSetProfile(u.host))},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${((Q=(B=u==null?void 0:u.participants)==null?void 0:B[0])==null?void 0:Q.avatar)??"./assets/img/icons/instagram/unknown-pfp.jpg"})`}}),a("div",{className:"name",children:[e(at,{usernames:u.participants.map(L=>L.username)}),((ue=(ce=u==null?void 0:u.participants)==null?void 0:ce[0])==null?void 0:ue.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(Oe,{})]})]}),a("div",{className:"stats",children:[e("div",{className:"live",children:n("APPS.INSTAGRAM.LIVE")}),a("div",{className:"viewers",onClick:()=>p("viewers"),children:[e("i",{className:"fas fa-eye"}),u.viewers]}),e("i",{className:"far fa-times x",onClick:()=>{P||l?q():b(!1)}})]})]}),a("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:I,children:g.map((L,v)=>{let V=L.user.avatar??"./assets/img/icons/instagram/unknown-pfp.jpg";return a("div",{className:"comment",children:[e("img",{src:V}),a("div",{className:"info",children:[a("div",{className:"name",children:[L.user.username,L.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:L.content})]})]},v)})}),a("div",{className:"comment-input",children:[e(te,{type:"text",ref:M,placeholder:n("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:L=>h(L.target.value),onKeyDown:L=>{L.key==="Enter"&&G.replace(/ /g,"").length>0&&(K(),M.current.value="")}}),e("i",{className:"far fa-paper-plane",onClick:()=>{G.replace(/ /g,"").length>0&&(K(),M.current.value="")}}),(P||l)&&e("i",{className:"fas fa-repeat",onClick:()=>{N("Instagram",{action:"flipCamera"})}})]})]})]})]})}const tt=i=>{const f=s.useRef(null);return s.useEffect(()=>{if(!(f!=null&&f.current))return H("warning","No video ref");f.current.srcObject=i.stream,f.current.play()},[i==null?void 0:i.stream]),a("div",{className:"instagram-stream",children:[i.host&&e(re,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:i.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:i.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{N("Instagram",{action:"removeLive",username:i.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:f})]})},at=i=>{let f=i.usernames.map((E,o)=>E).join(", ");return f.length>11&&(f=f.substring(0,11)+"...",f[f.length-3]===","&&(f=f.substring(0,f.length-3)+"...")),e(Y,{children:f})},st=i=>{var d;const{Func:f}=s.useContext(X),E=(d=se(ee))==null?void 0:d.participants,[o,A]=s.useState([]);return s.useEffect(()=>{var m;if(i.type==="participants"){A((m=ee.value)==null?void 0:m.participants);return}N("Instagram",{action:"getLiveViewers",username:i.username}).then(u=>{u&&A(u)})},[]),a(Se.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>i.close()}),e("div",{className:"title",children:i.type==="viewers"?n("APPS.INSTAGRAM.WHOS_WATCHING"):n("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:o.map((m,u)=>a("div",{className:"item",children:[a("div",{className:"user",onClick:()=>{i.host||(i.endLive(!1,!1),f.fetchAndSetProfile(m.username))},children:[e("div",{className:"profile-picture",children:e("img",{src:f.getAvatar(m.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[m.username,m.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:m.name})]})]}),i.host&&i.type==="viewers"&&(E.find(P=>P.username===m.username)?e("div",{className:"remove",onClick:P=>{P.stopPropagation(),z.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:m.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:m.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{N("Instagram",{action:"removeLive",username:m.username}).then(()=>{})}}]})},children:n("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:P=>{P.stopPropagation(),N("Instagram",{action:"inviteLive",username:m.username})},children:n("APPS.INSTAGRAM.INVITE")}))]},u))})})]})};function _e(i){const f=se(oe.Settings);return e(Y,{children:i.liked?e("svg",{onClick:i.onClick,color:"#ed4956",fill:"#ed4956",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})}):e("svg",{onClick:i.onClick,color:f.display.theme==="dark"?"#ffffff":"#262626",fill:f.display.theme==="dark"?"#ffffff":"#262626",height:"24",viewBox:"0 0 24 24",width:"24",children:e("path",{d:"M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"})})})}function be(i){const{Account:f,View:E,Func:o,UserPanel:A}=s.useContext(X),[d]=f,[m,u]=E,[P,C]=A,[l,t]=s.useState(i.data),S=s.useRef(null),[p,G]=s.useState(0),[h,I]=s.useState(!1),M={pos:{startLeft:0,startX:0},onMouseDown:T=>{M.pos={startLeft:S.current.scrollLeft,startX:T.clientX},S.current.style.userSelect="none",document.addEventListener("mouseup",M.onMouseUp),document.addEventListener("mousemove",M.onMove)},onMove:T=>{const k=(T.clientX-M.pos.startX)/he();S.current.scrollLeft=M.pos.startLeft-k;const y=S.current.getBoundingClientRect();(y.left*he()-5>T.clientX||T.clientX>y.right*he()-5)&&M.onMouseUp()},onMouseUp:()=>{S.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",M.onMouseUp),document.removeEventListener("mousemove",M.onMove);const T=JSON.parse(l.media),k=S.current.clientWidth;let y=p;const D=S.current.scrollLeft-M.pos.startLeft;D>k/2&&y<T.length-1?y++:D<-k/2&&y>0&&y--,_(y)}},_=T=>{S.current.scrollTo({left:T*S.current.offsetWidth,behavior:"smooth"}),G(T)};Z("instagram:updatePostData",T=>{!T||T.postId!==l.id||t(k=>({...k,[T.data]:T.increment?k[T.data]+1:k[T.data]-1}))});const F=T=>{if(T.detail===2){if(!l.id)return;l.liked||N("Instagram",{action:"toggleLike",data:{postId:l.id,toggle:!l.liked,isComment:!1}}).then(k=>{t({...l,liked:k})}),I(!0),setTimeout(()=>I(!1),1e3)}};return a("div",{className:"post",id:i.last?"last":"","data-id":l.id,"data-active":i.active,children:[a("div",{className:"post-header",children:[e("img",{className:"profile-picture",onClick:()=>{o.fetchAndSetProfile(l.username)},src:o.getAvatar(l.avatar)}),a("div",{className:"post-info",children:[a("div",{className:"name",onClick:()=>o.fetchAndSetProfile(l.username),children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),l.location&&e("div",{className:"location",children:l.location})]})]}),a("div",{className:"post-body",children:[h&&e("div",{className:`popup-heart ${h?"show":"hide"}`,children:e("svg",{color:"#e3e3e3",fill:"#e3e3e3",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})})}),e("div",{className:"image-container",ref:S,onMouseDown:M.onMouseDown,children:JSON.parse(l.media).map((T,k)=>e("div",{className:"image",onClick:F,children:ae(T)?e(nt,{attachment:T,active:i.active}):e("img",{src:T})},k))}),a("div",{className:"actions",children:[a("div",{className:"like-comment",children:[e(_e,{liked:l.liked,onClick:()=>{l.id&&N("Instagram",{action:"toggleLike",data:{postId:l.id,toggle:!l.liked,isComment:!1}}).then(T=>{t(k=>({...k,liked:T}))})}}),e("svg",{onClick:()=>o.fetchAndSetComments({id:l.id,username:l.username,avatar:l.avatar,verified:l.verified,caption:l.caption,timestamp:l.timestamp}),color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",children:e("path",{d:"M20.656 17.008a9.993 9.993 0 10-3.59 3.615L22 22z",fill:"none",stroke:"currentColor",strokeWidth:"2px"})}),(l.username===d.username||d.isAdmin)&&e(xe,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:n("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"deletePost",id:l.id}).then(T=>{T&&u("feed")})}}]})}})]}),JSON.parse(l.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(l.media).map((T,k)=>e("div",{className:`dot ${p==k?"active":""}`,onClick:()=>_(k)},k))})]}),a("div",{className:"liked-by",onClick:()=>{C({display:!0,data:{title:n("APPS.INSTAGRAM.LIKED_BY"),postId:l.id,cb:()=>{u("feed")}}})},children:[l.like_count," ",n("APPS.INSTAGRAM.LIKES")]}),a("div",{className:"caption",children:[e("span",{className:"user",onClick:T=>{T.stopPropagation(),o.fetchAndSetProfile(l.username)},children:l.username}),ge(l.caption)," "]}),e("div",{className:"comments",onClick:T=>{T.stopPropagation(),o.fetchAndSetComments({id:l.id,username:l.username,avatar:l.avatar,verified:l.verified,caption:l.caption,timestamp:l.timestamp})},children:l.comment_count>0?n("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:l.comment_count}):n("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:We(l.timestamp)})]})]})}const nt=i=>{var d;const[f,E]=s.useState(i.active),o=se(oe.Settings),A=s.useRef(null);return s.useEffect(()=>{var m;E(i.active),!(!A.current||!((m=o==null?void 0:o.sound)!=null&&m.volume))&&i.active&&(A.current.volume=o.sound.volume,A.current.currentTime=0)},[i.active]),s.useEffect(()=>{var m;!A.current||!((m=o==null?void 0:o.sound)!=null&&m.volume)||i.active&&(A.current.volume=o.sound.volume)},[(d=o==null?void 0:o.sound)==null?void 0:d.volume]),e("video",{src:i.attachment,autoPlay:!0,loop:!0,muted:!i.active,ref:A,onLoadedMetadata:m=>{i.active&&(m.currentTarget.volume=o.sound.volume)}})};function it(){const{Account:i,View:f,Func:E,Stories:o}=s.useContext(X),[A,d]=f,[m]=i,[u,P]=s.useState([]),[C,l]=s.useState([]),[t,S]=o,[p,G]=s.useState(0),[h,I]=s.useState(!1),[M,_]=s.useState(!1),[F,T]=s.useState(null);s.useEffect(()=>{N("Instagram",{action:"getPosts",filters:{following:!0},page:0}).then(r=>{r&&P(r)})},[]),s.useEffect(()=>{A==="feed"&&(N("Instagram",{action:"getLives"}).then(r=>{r&&l(r)}),N("Instagram",{action:"getStories"}).then(r=>{r&&S([...r.sort((c,w)=>{if(c.seen===w.seen)return 0;if(c.seen===1)return 1;if(w.seen===1)return-1})])}))},[A]);const k=new IntersectionObserver(y,{rootMargin:"20px",threshold:.5});function y(r){r.forEach(c=>{if(c.isIntersecting){let R=c.target.getAttribute("data-id");T(R)}})}const D=()=>{if(h||M)return;let r=document.querySelector("#last");if(!r)return;document.querySelectorAll(".post").forEach(R=>k.observe(R)),!ne(r)&&(_(!0),N("Instagram",{action:"getPosts",filters:{following:!0},page:p+1}).then(R=>{R&&R.length>0?(P([...u,...R]),_(!1)):I(!0)}),G(R=>R+1))};s.useEffect(()=>{const r=document.querySelector(".stories");return r.addEventListener("wheel",c=>{c.preventDefault(),r.scrollLeft+=c.deltaY}),()=>{r.removeEventListener("wheel",c=>{c.preventDefault(),r.scrollLeft+=c.deltaY})}},[]),Z("instagram:updateLives",r=>{r&&l(r)});const x=()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"goLive",user:{username:m.username,avatar:E.getAvatar(m==null?void 0:m.avatar),verified:m.verified}}).then(r=>{if(!r)return H("error","Failed to go live");ee.set({host:m.username,participants:[{username:m.username,name:m.username,avatar:E.getAvatar(m==null?void 0:m.avatar),verified:m.verified}],viewers:0}),d("live")})}}]})};return a(Y,{children:[a("div",{className:"instagram-header feed-header",children:[a("div",{className:"name",children:[m.username,m.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),a("svg",{onClick:()=>d("dmList"),color:"#262626",fill:"#262626",height:"24",role:"img",viewBox:"0 0 24 24",width:"24",children:[e("line",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2",x1:"22",x2:"9.218",y1:"3",y2:"10.083"}),e("polygon",{fill:"none",points:"11.698 20.334 22 3.001 2 3.001 9.218 10.084 11.698 20.334",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2"})]})]}),a("div",{className:"feed",onScroll:D,children:[e("div",{className:"stories-wrapper",children:a("div",{className:"stories",children:[a("div",{className:"story self",onClick:()=>{z.ContextMenu.set({buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE"),cb:()=>x()},{title:n("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var r,c,w;z.Gallery.set({includeVideos:!0,allowExternal:(w=(c=(r=Pe)==null?void 0:r.value)==null?void 0:c.AllowExternal)==null?void 0:w.Instagram,onSelect:R=>{N("Instagram",{action:"addToStory",media:R.src}).then(g=>{g&&S([{username:m.username,avatar:m.avatar,verified:m.verified,seen:0,id:g},...t.filter(U=>U.username!==m.username)])})}})}}]})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar(m==null?void 0:m.avatar)})`},children:e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})}),e("div",{className:"name",children:n("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(C).map((r,c)=>{var w;return a("div",{className:"story",onClick:()=>{var R;N("Instagram",{action:"viewLive",username:((R=C[r])==null?void 0:R.participant)??r}).then(g=>{var $,q,K,b;if(!g)return H("error","Failed to view live, perhaps it ended?");let U=($=C[r])!=null&&$.participant?C[(q=C[r])==null?void 0:q.participant]:C[r],O=(U==null?void 0:U.participants)??[];O.unshift({username:((K=C[r])==null?void 0:K.participant)??r,name:U.name,avatar:U.avatar,verified:U.verified,id:U.id}),ee.set({host:((b=C[r])==null?void 0:b.participant)??r,participants:O,viewers:g}),d("live")})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar((w=C[r])==null?void 0:w.avatar)})`},children:e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.png"})}),e("div",{className:"name",children:r})]},c)}),t.map((r,c)=>a("div",{className:"story",onClick:w=>{let[R,g]=ke(w);E.fetchAndSetStory(r,null,{x:R,y:g})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar(r==null?void 0:r.avatar)})`},children:e("img",{className:"circle","data-seen":r.seen===1,src:"./assets/img/icons/instagram/StoryCircle.png"})}),e("div",{className:"name",children:r.username})]},c))]})}),u.length===0&&e("div",{className:"no-posts",children:n("APPS.INSTAGRAM.EMPTY_FEED")}),u.map((r,c)=>{let w=c===u.length-1;return e(be,{data:r,active:F===r.id,last:w},c)})]})]})}function Re(){const{View:i,Account:f,LoggedIn:E}=s.useContext(X),o=se(oe.Settings),[A,d]=s.useState(""),[m,u]=s.useState(""),[P,C]=s.useState(""),[l,t]=s.useState(!1),[S,p]=s.useState(!1),[G,h]=s.useState(!1),[I,M]=i,[_,F]=f,[T,k]=E,[y,D]=s.useState("login"),x=()=>{t(!1),p(!1),N("Instagram",{action:"logIn",username:m,password:P}).then(c=>{c.success&&c.account?(p(!1),t(!1),N("isAdmin").then(w=>{ie.APPS.INSTAGRAM.account.set(c.account),F({...c.account,isAdmin:w}),M("feed"),k(!0)})):c.error=="no account"?t(!0):c.error=="wrong password"?p(!0):console.log(c.error)})},r=()=>{let c=m.toLowerCase().replace(/\s/g,"");c.length<3||c.length>15||N("Instagram",{action:"createAccount",name:A,username:c,password:P}).then(w=>{w.success?(p(!1),t(!1),N("isAdmin").then(R=>{let g={name:A,username:c,posts:0,followers:0,following:0};ie.APPS.INSTAGRAM.account.set(g),F({...g,isAdmin:R}),M("feed"),k(!0)})):console.log("couldn't create account",w)})};return s.useEffect(()=>{p(!1),t(!1)},[y]),e("div",{className:"log-in",children:a(Y,{children:[e("div",{className:"wrapper",children:y==="login"?a(Y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":o.display.theme}),a("div",{className:"form",children:[e(te,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:c=>u(c.target.value.replace(/\s/g,"")),maxLength:15}),l&&e("div",{className:"instagram-wrong",children:n("APPS.INSTAGRAM.NO_ACCOUNT")}),e(te,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:c=>C(c.target.value),maxLength:50}),S&&e("div",{className:"instagram-wrong",children:n("APPS.INSTAGRAM.WRONG_USERNAME_OR_PASSWORD")}),e("div",{className:"button",onClick:x,children:n("APPS.INSTAGRAM.LOG_IN")})]})]}):a(Y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":o.display.theme}),a("div",{className:"form",children:[e(te,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:c=>d(c.target.value),maxLength:20}),e(te,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:c=>u(c.target.value.replace(/\s/g,"")),maxLength:15}),G&&e("div",{className:"instagram-wrong",children:n("APPS.INSTAGRAM.ACCOUNT_WITH_USERNAME")}),e(te,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:c=>C(c.target.value),maxLength:50}),e("div",{className:"button",onClick:r,children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:y==="login"?a(Y,{children:[n("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>D("createAccount"),children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):a(Y,{children:[n("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>D("login"),children:n("APPS.INSTAGRAM.LOG_IN")})]})})]})})}const pe=Me(!1);function rt(){var t,S,p,G;const{Func:i}=s.useContext(X),[f,E]=s.useState(null),o=se(pe),[A,d]=s.useState(0),[m,u]=s.useState(!1),[P,C]=s.useState(!1);s.useEffect(()=>{N("Instagram",{action:"getNotifications"}).then(h=>{if(!h)return H("warning","Failed to fetch notifications, or no results?");E(h)})},[]);const l=()=>{if(m||P)return;let h=document.querySelector("#last");if(!h)return;!ne(h)&&(C(!0),N("Instagram",{action:"getNotifications",page:A+1}).then(M=>{M&&(M==null?void 0:M.notifications.length)>0?(E(_=>({..._,notifications:[..._.notifications,...M.notifications]})),C(!1)):u(!0)}),d(M=>M+1))};return a("div",{className:"notifications-container",children:[e(ve,{children:o&&e(ct,{})}),e("div",{className:"notifications-header",children:n("APPS.INSTAGRAM.ACTIVITY")}),a("div",{className:"notifications-body",onScroll:l,children:[((t=f==null?void 0:f.requests)==null?void 0:t.total)>0&&a("div",{className:"follow-requests",onClick:()=>pe.set(!0),children:[a("div",{className:"item-data",children:[e("div",{className:"profile-pictures","data-multiple":f.requests.total>1,children:f.requests.recent.map((h,I)=>e("img",{src:i.getAvatar(h.avatar)},I))}),a("div",{className:"item-body",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("div",{className:"subtitle",children:f.requests.total>1?n("APPS.INSTAGRAM.ANDOTHERS").format({username:(S=f.requests.recent[0])==null?void 0:S.username,amount:((p=f.requests)==null?void 0:p.total)-1}):(G=f.requests.recent[0])==null?void 0:G.username})]})]}),a("div",{className:"actions",children:[e("div",{className:"blue-dot"}),e(Ge,{})]})]}),f==null?void 0:f.notifications.map((h,I)=>{let M=I===f.notifications.length-1?"last":"";return e(lt,{notification:h,last:M},I)})]})]})}const ct=()=>{const{Func:i}=s.useContext(X),[f,E]=s.useState(""),[o,A]=s.useState([]),[d,m]=s.useState(0),[u,P]=s.useState(!1),[C,l]=s.useState(!1),t=[{class:"follow",label:n("APPS.INSTAGRAM.CONFIRM"),action:!0},{class:"following",label:n("APPS.INSTAGRAM.DELETE"),action:!1}];s.useEffect(()=>{N("Instagram",{action:"getFollowRequests",page:0}).then(p=>{if(!p)return H("warning","Failed to fetch follow requests");H("info","Fetched follow requests",p),A(p)})},[]);const S=()=>{if(u||C)return;let p=document.querySelector("#lastrequest");if(!p)return;!ne(p)&&(l(!0),N("Instagram",{action:"getFollowRequests",page:d+1}).then(h=>{h&&(h==null?void 0:h.length)>0?(A(h),l(!1)):P(!0)}),m(h=>h+1))};return a(Se.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"requests-container",children:[a("div",{className:"requests-header",children:[e("div",{className:"icon",children:e(Ne,{onClick:()=>pe.set(!1)})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("span",{})]}),a("div",{className:"requests-body",children:[e(Ae,{placeholder:n("SEARCH"),onChange:p=>E(p.target.value)}),e("div",{className:"items",onScroll:S,children:o.filter(p=>p.username.toLowerCase().includes(f.toLowerCase())||p.name.toLowerCase().includes(f.toLowerCase())).map((p,G)=>{let h=G===o.length-1?"lastrequest":"";return a("div",{id:h,className:"item",children:[a("div",{className:"user",onClick:()=>i.fetchAndSetProfile(p.username),children:[e("img",{className:"avatar",src:i.getAvatar(p.avatar)}),a("div",{className:"user-info",children:[a("div",{className:"username",children:[p.username,p.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:p.name})]})]}),e("div",{className:"buttons",children:t.map((I,M)=>e("div",{className:ye("button",I.class),onClick:_=>{_.stopPropagation(),N("Instagram",{action:"handleFollowRequest",username:p.username,accept:I.action}).then(F=>{if(!F)return H("warning","Failed to handle follow request");A(T=>T.filter(k=>k.username!==p.username))})},children:I.label},M))})]},G)})})]})]})},lt=({notification:i,last:f})=>{const{Account:E,Func:o}=s.useContext(X),[A]=E,[d,m]=s.useState(i.isFollowing);switch(i.type){case"like_photo":return a("div",{className:"notification-item",id:f,onClick:()=>o.fetchAndSetPost(i.postId),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(i.avatar),onClick:P=>{P.stopPropagation(),o.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:le(i.timestamp)})]})]}),ae(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"like_comment":return e("div",{className:"notification-item",id:f,onClick:()=>o.fetchAndSetPost(i.postId,!0),children:a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(i.avatar),onClick:P=>{P.stopPropagation(),o.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:i.comment}),e("span",{className:"date",children:le(i.timestamp)})]})]})});case"comment":return a("div",{className:"notification-item",id:f,onClick:()=>o.fetchAndSetPost(i.postId,!0),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(i.avatar),onClick:P=>{P.stopPropagation(),o.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.COMMENTED").format({comment:i.comment}),e("span",{className:"date",children:le(i.timestamp)})]})]}),ae(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"follow":return a("div",{className:"notification-item",id:f,onClick:()=>o.fetchAndSetProfile(i.username),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(i.avatar),onClick:()=>o.fetchAndSetProfile(i.username)}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:le(i.timestamp)})]})]}),e("div",{className:`button ${d?"following":"follow"}`,onClick:P=>{P.stopPropagation(),A.username!==i.username&&(d?z.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:i.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"toggleFollow",data:{username:i.username,following:!d}}).then(()=>{m(C=>!C)})}}]}):N("Instagram",{action:"toggleFollow",data:{username:i.username,following:!d}}).then(()=>{m(C=>!C)}))},children:d?n("APPS.INSTAGRAM.FOLLOWING"):n("APPS.INSTAGRAM.FOLLOW")})]})}};function ot(){const{View:i,Profile:f,Account:E,Func:o,GoBack:A,Post:d,UserPanel:m,LoggedIn:u,Dm:P}=s.useContext(X),[C,l]=i,[t,S]=f,[p,G]=u,[h,I]=E,[M,_]=d,[F,T]=P,[k,y]=m,[D,x]=A,[r,c]=s.useState(!1),[w,R]=s.useState(!1),[g,U]=s.useState(null),[O,$]=s.useState(0),[q,K]=s.useState(!1),[b,B]=s.useState(!1);s.useEffect(()=>{t.username&&(c(h.username===t.username),N("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:0}).then(v=>{v&&U(v)}))},[t==null?void 0:t.username]);const Q=()=>{if(q||b)return;let v=document.querySelector("#last");if(!v)return;!ne(v)&&(B(!0),N("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:O+1}).then(W=>{W&&W.length>0?(U([...g,...W]),B(!1)):K(!0)}),$(W=>W+1))},ce=()=>{if(!t.name)return H("warning","Name is required, not saving");N("Instagram",{action:"updateProfile",data:{name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}}).then(v=>{if(!v)return H("warning","Failed to update profile");R(!1),H("info","Successfully updated profile")})};Z("instagram:updateProfileData",v=>{v.username===t.username&&S({...t,[v.data]:v.increment?t[v.data]+1:t[v.data]-1})});const ue=s.useRef(!0);s.useEffect(()=>{if(ue.current){ue.current=!1;return}N("Instagram",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}})},[t.isFollowing]);const L=()=>{N("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(v=>{var j;if(!v)return H("info","No accounts found");let V=h.isAdmin,W=(j=v==null?void 0:v.filter(J=>J!==t.username))==null?void 0:j.map(J=>({title:J,cb:()=>{N("AccountSwitcher",{action:"switch",app:"Instagram",account:J}).then(fe=>{N("Instagram",{action:"isLoggedIn"}).then(de=>{de?(ie.APPS.INSTAGRAM.account.set(de),I({...de,isAdmin:V}),l("feed"),G(!0)):ie.APPS.INSTAGRAM.account.set(null)})})}}));z.ContextMenu.set({buttons:[{title:h.username},...W,{title:n("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>{G(!1)}}]})})};return e(Y,{children:t&&a("div",{className:"profile",children:[e(ve,{children:w&&a(Se.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[a("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>R(!1),children:n("CANCEL")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>ce(),children:n("APPS.INSTAGRAM.DONE")})]}),a("div",{className:"edit-profile-body",children:[a("div",{className:"profile-picture",onClick:()=>{var v,V,W;z.Gallery.set({allowExternal:(W=(V=(v=Pe)==null?void 0:v.value)==null?void 0:V.AllowExternal)==null?void 0:W.Instagram,onSelect:j=>{S({...t,avatar:j.src}),I({...h,avatar:j.src})}})},children:[e("img",{src:o.getAvatar(t.avatar),alt:"profile"}),e("span",{children:n("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),a("div",{className:"profile-items",children:[a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.NAME")}),e(te,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:v=>{S({...t,name:v.target.value})},maxLength:30,defaultValue:t.name})]}),a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.BIO")}),e(Ve,{placeholder:n("APPS.INSTAGRAM.BIO"),onChange:v=>{S({...t,bio:v.target.value})},maxLength:100,defaultValue:t.bio??""})]}),a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE")}),e("div",{className:"switch-wrapper",children:e(qe,{checked:t.private,onChange:()=>S({...t,private:!t.private})})})]})]}),e("div",{className:"sign-out",onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"signOut"}).then(v=>{G(null),I(null),ie.APPS.INSTAGRAM.account.set(null)})}}]})},children:n("APPS.INSTAGRAM.SIGN_OUT")})]})]})}),r?e("div",{className:"instagram-header",children:a("div",{className:"name",style:{cursor:"pointer"},onClick:()=>L(),children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(Oe,{})]})}):a("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{D!=null&&D.cb?D.cb():l("feed")}}),a("div",{className:"name",children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),a("div",{className:"profile-body",children:[a("div",{className:"profile-wrapper",children:[a("div",{className:"top",children:[a("div",{className:"profile-picture",style:{backgroundImage:`url(${o.getAvatar(t.avatar)})`},children:[t.isLive&&(!t.private||t.isFollowing||!r)?e("img",{onClick:()=>{N("Instagram",{action:"getLives"}).then(v=>{var W;let V=t.username;N("Instagram",{action:"viewLive",username:((W=v[V])==null?void 0:W.participant)??V}).then(j=>{var de,Ie,Ee,Ce;if(!j)return H("error","Failed to view live, perhaps it ended?");let J=(de=v[V])!=null&&de.participant?v[(Ie=v[V])==null?void 0:Ie.participant]:v[V],fe=(J==null?void 0:J.participants)??[];fe.unshift({username:((Ee=v[V])==null?void 0:Ee.participant)??V,name:J.name,avatar:J.avatar,verified:J.verified,id:J.id}),ee.set({host:((Ce=v[V])==null?void 0:Ce.participant)??V,participants:fe,viewers:j}),l("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.png"}):null,t.hasStory&&!t.isLive&&(!t.private||t.isFollowing||r)?e("img",{className:"circle","data-seen":t.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.png",onClick:v=>{let[V,W]=ke(v);o.fetchAndSetStory({username:t.username,avatar:t.avatar,verified:t.verified},null,{x:V,y:W})}}):null]}),a("div",{className:"stats",children:[a("div",{children:[e("div",{className:"value",children:t.posts}),e("div",{className:"label",children:t.posts===1?n("APPS.INSTAGRAM.POST"):n("APPS.INSTAGRAM.POSTS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!r,onClick:()=>{!t.isFollowing&&t.private&&!r||y({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWERS"),username:t.username,cb:()=>{S(t),l("profile"),y({display:!1})}}})},children:[e("div",{className:"value",children:t.followers}),e("div",{className:"label",children:t.followers===1?n("APPS.INSTAGRAM.FOLLOWER"):n("APPS.INSTAGRAM.FOLLOWERS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!r,onClick:()=>{!t.isFollowing&&t.private&&!r||y({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWING"),username:t.username,cb:()=>{S(t),l("profile"),y({display:!1})}}})},children:[e("div",{className:"value",children:t.following}),e("div",{className:"label",children:n("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:t.name}),e("div",{className:"description",children:ge(t.bio)??""}),e("div",{className:"buttons",children:r?r&&e("div",{className:"button edit",onClick:()=>R(!0),children:n("APPS.INSTAGRAM.EDIT_PROFILE")}):a(Y,{children:[e("div",{className:ye("button",t.requested||t.isFollowing?"following":"follow"),onClick:()=>{t.isFollowing?z.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{S({...t,isFollowing:!1})}}]}):t.private?N("Instagram",{action:"toggleFollow",data:{username:t.username,following:!0}}).then(v=>{v&&S({...t,requested:!t.requested})}):S({...t,isFollowing:!0})},children:t.isFollowing?n("APPS.INSTAGRAM.FOLLOWING"):t.requested?n("APPS.INSTAGRAM.REQUESTED"):n("APPS.INSTAGRAM.FOLLOW")}),!t.private||t.isFollowing?e("div",{className:"button following",onClick:()=>{T({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),l("dm")},children:n("APPS.INSTAGRAM.MESSAGE")}):null]})})]}),t.private&&!t.isFollowing&&!r?a("div",{className:"private-account",children:[e("div",{className:"icon",children:e(He,{})}),e("div",{className:"title",children:"This account is private"}),e("div",{className:"description",children:"Follow this account to see their photos and videos."})]}):e("div",{className:"posts",onScroll:Q,children:g&&g.map((v,V)=>{let W=V===g.length-1?"last":"",j=JSON.parse(v.media)[0];return e("div",{id:W,onClick:()=>{x({cb:()=>{S(t),l("profile"),_(null),x(null)}}),_(v),l("post")},children:ae(j)?e("video",{src:j,muted:!0,autoPlay:!0,loop:!0}):e("img",{src:j})},V)})})]})]})})}function dt(){const{Func:i,View:f,GoBack:E,Post:o}=s.useContext(X),[A,d]=f,[m,u]=E,[P,C]=o,[l,t]=s.useState(""),[S,p]=s.useState(""),[G,h]=s.useState([]);s.useState([]);const[I,M]=s.useState([]),[_,F]=s.useState(0),[T,k]=s.useState(!1),[y,D]=s.useState(!1);s.useEffect(()=>{N("Instagram",{action:"getPosts",page:0}).then(r=>{r&&M(r)})},[]),s.useEffect(()=>{const r=setTimeout(()=>t(S),500);return()=>clearTimeout(r)},[S]),s.useEffect(()=>{l.length>0&&N("Instagram",{action:"search",query:l}).then(r=>{r&&h(r)})},[l]);const x=()=>{if(T||y||l.length>0)return;let r=document.querySelector("#last");if(!r)return;!ne(r)&&(D(!0),N("Instagram",{action:"getPosts",page:_+1}).then(w=>{w&&w.length>0?(M([...I,...w]),D(!1)):k(!0)}),F(w=>w+1))};return a("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(Ae,{placeholder:n("SEARCH"),onChange:r=>p(r.target.value)})}),e("div",{className:"search-body",onScroll:x,children:l.length>0?e("div",{className:"search-results",children:G.map(r=>a("div",{className:"item",onClick:()=>i.fetchAndSetProfile(r.username),children:[e("div",{className:"profile-picture",children:e("img",{src:i.getAvatar(r.avatar),alt:"profile"})}),a("div",{className:"user",children:[a("div",{className:"username",children:[r.username,r.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:r.name})]})]}))}):e("div",{className:"feed-grid",children:I.map((r,c)=>{let R=Math.floor(c/3)%2==0,g=!1;g=c%3==(R?1:0),I[c+1]||(g=!1);let U=JSON.parse(r.media)[0],O=c==I.length-1?"last":"";return e("div",{id:O,className:`grid-post${g?" big":""}`,onClick:()=>{u({cb:()=>{d("search"),u(null)}}),C(r),d("post")},children:ae(U)?e("video",{src:U,autoPlay:!0,loop:!0,muted:!0}):e("img",{src:U,alt:"post"})},c)})})})]})}function mt(){const{View:i,GoBack:f,Comments:E,Account:o,Func:A}=s.useContext(X),[d]=o,[m,u]=i,[P]=f,[C,l]=E,[t,S]=s.useState(""),p=s.useRef(null),[G,h]=s.useState(0),[I,M]=s.useState(!1),[_,F]=s.useState(!1),T=()=>{t.length!==0&&N("Instagram",{action:"postComment",data:{postId:C.post.id,comment:t}}).then(y=>{if(!y)return H("error","Failed to post comment, no ");S(""),p.current.value="",l({...C,post:C.post,comments:[{user:{username:d.username,avatar:d.avatar,verified:d.verified},comment:{id:y,content:t,timestamp:new Date().getTime(),likes:0,liked:!1}},...C.comments]})})},k=()=>{if(I||_)return;let y=document.querySelector("#last");if(!y)return;!ne(y)&&(F(!0),N("Instagram",{action:"getComments",postId:C.post.id,page:G+1}).then(x=>{x&&x.length>0?(l({...C,comments:[...C.comments,...x]}),F(!1)):M(!0)}),h(x=>x+1))};return a("div",{className:"comments-container",children:[a("div",{className:"comments-header",children:[e(Ne,{onClick:()=>{P&&(P!=null&&P.cb)?P.cb():u("feed")}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),a("div",{className:"comments-body",onScroll:k,children:[a("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(C.post.avatar),alt:"profile"})}),a("div",{className:"post-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",children:[C.post.username,C.post.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),ge(C.post.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:Fe(C.post.timestamp)})})]})]}),C.comments.map((y,D)=>{let x=D===C.comments.length-1;return e(ut,{data:y,last:x},D)})]}),a("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(d.avatar),alt:"profile"})}),a("div",{className:"input-container",children:[e(te,{type:"text",ref:p,placeholder:n("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:d.username}),onKeyPress:y=>{y.key==="Enter"&&T()},onChange:y=>S(y.target.value)}),e("div",{className:"send",onClick:T,children:n("APPS.INSTAGRAM.POST")})]})]})]})}const ut=({data:i,last:f})=>{const{Func:E}=s.useContext(X),[o,A]=s.useState(i.comment.liked),[d,m]=s.useState(i.comment.likes);return Z("instagram:updateCommentLikes",u=>{!u||u.commentId!==i.comment.id||m(P=>P+(u.increment?1:-1))}),a("div",{className:"comment",id:f&&"last",children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:()=>E.fetchAndSetProfile(i.user.username),children:e("img",{src:E.getAvatar(i.user.avatar),alt:"profile"})}),a("div",{className:"comment-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",onClick:()=>E.fetchAndSetProfile(i.user.username),children:[i.user.username,i.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),i.comment.content]}),a("div",{className:"actions",children:[e("div",{className:"date",children:Fe(i.comment.timestamp)}),a("div",{className:"likes",children:[d," ",n("APPS.INSTAGRAM.LIKES").toLowerCase()]})]})]})]}),e(_e,{liked:o,onClick:()=>{i.comment.id&&N("Instagram",{action:"toggleLike",data:{postId:i.comment.id,toggle:!o,isComment:!0}}).then(u=>{A(u)})}})]})},Fe=i=>{const f=new Date(i),o=new Date().getTime()-f.getTime(),A=Math.floor(o/(1e3*60*60*24)),d=Math.floor(o/(1e3*60*60)),m=Math.floor(o/(1e3*60));let u="";return A<1?d<1?u=`${m}m`:u=`${d}h`:A<30?u=`${A}d`:u=`${f.getDate()}/${f.getMonth()+1}/${f.getFullYear()}`,u};function ft(){var y,D,x;const{View:i}=s.useContext(X),[f,E]=i,[o,A]=s.useState(0),[d,m]=s.useState([]),[u,P]=s.useState(""),[C,l]=s.useState(null),[t,S]=s.useState([]),[p,G]=s.useState(""),[h,I]=s.useState(0),[M,_]=s.useState(!1),[F,T]=s.useState(!1);s.useEffect(()=>{N("Camera",{action:"getImages",page:0,filter:{showVideos:!0,showPhotos:!0}}).then(r=>{r&&S(r)})},[]);const k=r=>{if(F||M)return;let c=document.querySelector("#last");if(!c)return;!ne(c)&&(_(!0),N("Camera",{action:"getImages",page:h+1,filter:{showVideos:!0,showPhotos:!0}}).then(R=>{R&&R.length>0?(S([...t,...R]),_(!1)):T(!0)}),I(R=>R+1))};return s.useEffect(()=>{p&&p.includes("data:image")||Be(p,r=>{if(r){const c=document.querySelector(".searchbox input");c&&(c.value=""),t.find(w=>w.src===p)||S(w=>[{src:p},...w])}})},[p]),a("div",{className:"newpost-container","data-camera":!1,children:[o===0&&a(Y,{children:[a("div",{className:"newpost-header",children:[e(re,{onClick:()=>E("feed")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{d.length>0&&o==0&&A(1)},children:n("APPS.INSTAGRAM.NEXT")})]}),((x=(D=(y=Pe)==null?void 0:y.value)==null?void 0:D.AllowExternal)==null?void 0:x.Instagram)&&e(Ae,{placeholder:n("COMPONENTS.GALLERY.EXTERNAL_URL"),onChange:r=>G(r.target.value)}),e("div",{className:"newpost-body",onScroll:k,children:e("div",{className:"images",children:t.map((r,c)=>{let w=c===t.length-1?"last":"";return a("div",{id:w,className:"image",onClick:()=>{d.includes(r.src)?m(d.filter(g=>g!==r.src)):d.length<5&&m([...d,r.src])},children:[ae(r.src)?e(ht,{src:r.src}):e("img",{src:r.src,alt:"image"}),e("div",{className:"select",children:e(Qe,{checked:d.includes(r.src)})})]},c)})})})]}),o===1&&a(Y,{children:[a("div",{className:"newpost-header",children:[e(Ne,{onClick:()=>A(0)}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{N("Instagram",{action:"newPost",data:{caption:u,location:C,images:d}}).then(r=>{r&&E("feed")})},children:n("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:a("div",{className:"newpost-content",children:[a("div",{className:"caption",children:[e("div",{className:"image",children:ae(d[0])?e("video",{src:d[0],muted:!0}):e("img",{src:d[0],alt:"image"})}),e("div",{className:"text-area",children:e(Ve,{onChange:r=>P(r.target.value),placeholder:n("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{z.PopUp.set({title:"Choose Location",description:"Choose a location for your post",input:{type:"text",maxCharacters:30,onChange:r=>l(r)},buttons:[{title:"Cancel"},{title:"Proceed"}]})},children:C?a(Y,{children:[a("div",{className:"label",children:[e($e,{}),C]}),e(re,{onClick:r=>{r.stopPropagation(),l(null)}})]}):a(Y,{children:[e("div",{className:"label",children:"Location"}),e(Ge,{})]})})]})})]})]})}const ht=({src:i})=>{const[f,E]=s.useState(null);return a(Y,{children:[e("video",{src:i,crossOrigin:"anonymous",controls:!1,onMouseOver:A=>A.currentTarget.play(),onMouseOut:A=>A.currentTarget.pause(),onLoadedMetadata:A=>E(A.currentTarget.duration)}),f&&e("div",{className:"video-duration",children:(A=>{const d=Math.floor(A/60),m=Je(A-d*60,0);return`${d}:${m<10?"0"+m:m}`})(f)})]})};function gt(){const{View:i,Post:f,GoBack:E}=s.useContext(X),[o,A]=i,[d]=E,[m]=f;return e(Y,{children:m&&e("div",{className:"viewpost-container",children:a(Y,{children:[a("div",{className:"viewpost-header",children:[e(Ne,{onClick:()=>{d&&(d.cb?d.cb():A(d.view))}}),e("div",{className:"name",children:m.username??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(be,{data:m})})]})})})}function vt(){const{Func:i,Account:f,Dm:E,View:o,GoBack:A}=s.useContext(X);se(oe.Settings);const[d]=f,[m,u]=o,[P,C]=E,[l,t]=A,[S,p]=s.useState([]),G=s.useRef(null),h=s.useRef(0),[I,M]=s.useState({content:"",attachments:[]}),[_,F]=s.useState(0),[T,k]=s.useState(!1),[y,D]=s.useState(!1);s.useEffect(()=>{k(!1),D(!1),F(0),p([]),N("Instagram",{action:"getMessages",page:0,username:P.username}).then(c=>{c&&p(c.reverse())})},[]),Z("instagram:newMessage",c=>{if(P.username!==c.sender)return;p([...S,c]);let w=document.querySelector(".dm-body-container");w.scrollTop=w.scrollHeight});const x=()=>{I.content.length===0&&I.attachments.length===0||N("Instagram",{action:"sendMessage",username:P.username,message:{content:I.content,attachments:I.attachments.length>0?I.attachments:null}}).then(c=>{if(!c)return;G.current.value="",p([...S,{sender:d.username,recipient:P.username,content:I.content,attachments:I.attachments,timestamp:Date.now()}]),M({content:"",attachments:[]});let w=document.querySelector(".dm-body-container");w.scrollTop=w.scrollHeight})},r=()=>{if(T||y)return;let c=document.querySelector("#last");if(!c)return;!ne(c)&&(D(!0),N("Instagram",{action:"getMessages",page:_+1,username:P.username}).then(R=>{if(R&&R.length>0){let g=document.querySelector(".dm-body-container");h.current=g.scrollHeight,p([...R.reverse(),...S]),D(!1)}else k(!0)}),F(R=>R+1))};return s.useEffect(()=>{let c=document.querySelector(".dm-body-container");const w=c.scrollHeight;c.scrollTop+=w-h.current,c.scroll},[S]),a("div",{className:"dm-container",children:[a("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{l&&l.cb?(l.cb(),t(null)):u("dmList")}}),a("div",{className:"profile",onClick:c=>{c.stopPropagation(),t({cb:()=>{C(P),u("dm")}}),i.fetchAndSetProfile(P.username)},children:[e("div",{className:"avatar",children:e("img",{src:i.getAvatar(P.avatar)})}),a("div",{className:"username",children:[P.name??P.username,P.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:r,children:e("div",{className:"dm-body",children:S.map((c,w)=>{var $;let R,g=w===0,U=c.sender===d.username?"self":"other",O=(($=S[w+1])==null?void 0:$.sender)===d.username?"self":"other";return S[w+1]?R=Math.abs(c.timestamp-S[w+1].timestamp)/36e5:O=void 0,a("div",{className:`message ${U}`,id:g?"last":"",children:[U=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${U!==O?"show":"hide"}`,onClick:q=>{q.stopPropagation(),t({cb:()=>{C(P),u("dm")}}),i.fetchAndSetProfile(P.username)},children:e("img",{src:i.getAvatar(P.avatar)})}),a("div",{className:"message-content",children:[c.content&&e("div",{className:"content",children:ge(c.content)}),c.attachments&&e("div",{className:"attatchments",children:c.attachments.map((q,K)=>ae(q)?e("video",{src:q,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:b=>{z.FullscreenImage.set({display:!0,image:q})}},K):e(Te,{src:q,onClick:()=>{z.FullscreenImage.set({display:!0,image:q})}},K))})]})]}):a(Y,{children:[c.content&&e("div",{className:"content",children:ge(c.content)}),c.attachments&&e("div",{className:"attatchments",children:c.attachments.map((q,K)=>ae(q)?e("video",{src:q,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:b=>{z.FullscreenImage.set({display:!0,image:q})}},K):e("img",{src:q,onClick:()=>{z.FullscreenImage.set({display:!0,image:q})}},K))})]}),S[w+1]&&R>6?e("div",{className:"date",children:Le(c.timestamp)}):U!==O&&e("div",{className:"date",children:Le(c.timestamp)})]},w)})})}),e("div",{className:"attachments",children:I.attachments.map((c,w)=>a("div",{className:"attachment",children:[ae(c)?e("video",{src:c,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(Te,{src:c}),e(re,{onClick:()=>{M({...I,attachments:I.attachments.filter((R,g)=>g!==w)})}})]},w))}),a("div",{className:"dm-footer",children:[e(te,{type:"text",ref:G,onChange:c=>{M({...I,content:c.target.value})},onKeyDown:c=>{c.key==="Enter"&&x()},placeholder:n("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),I.content.length>0?e("span",{onClick:()=>x(),className:"send",children:n("APPS.INSTAGRAM.SEND")}):e(je,{onClick:()=>{var c,w,R;I.attachments.length<3&&z.Gallery.set({includeVideos:!0,allowExternal:(R=(w=(c=Pe)==null?void 0:c.value)==null?void 0:w.AllowExternal)==null?void 0:R.Instagram,onSelect:g=>M({...I,attachments:[...I.attachments,g.src]})})}})]})]})}function Pt(){const{View:i,Func:f,Dm:E,Account:o,GoBack:A}=s.useContext(X),[d,m]=i,[u]=o,[P,C]=E,[l,t]=A,[S,p]=s.useState(!1),[G,h]=s.useState(""),[I,M]=s.useState(""),[_,F]=s.useState([]);s.useState([]);const[T,k]=s.useState([]),[y,D]=s.useState(0),[x,r]=s.useState(!1),[c,w]=s.useState(!1);s.useEffect(()=>{N("Instagram",{action:"getRecentMessages",page:0}).then(g=>{g&&k(g)})},[]);const R=()=>{if(x||c)return;let g=document.querySelector("#last");if(!g)return;!ne(g)&&(w(!0),N("Instagram",{action:"getRecentMessages",page:y+1}).then(O=>{O&&O.length>0?(k([...T,...O]),w(!1)):r(!0)}),D(O=>O+1))};return s.useEffect(()=>{const g=setTimeout(()=>h(I),500);return()=>clearTimeout(g)},[I]),s.useEffect(()=>{G.length>0?S?N("Instagram",{action:"search",query:G}).then(g=>{g&&F(g)}):F(T.filter(g=>{var U;return g.username.includes(G)||((U=g==null?void 0:g.name)==null?void 0:U.includes(G))&&g.username!==u.username})):F([])},[G]),s.useEffect(()=>{h(""),F([])},[S]),e("div",{className:"dm-list",children:S?a("div",{className:"slide up",children:[a("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{p(!1),F([])}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),a("div",{className:"dm-list-body ",children:[a("div",{className:"input",children:[e("span",{children:n("APPS.INSTAGRAM.TO")}),e(te,{type:"text",onChange:g=>M(g.target.value),placeholder:n("SEARCH")})]}),_.length>0&&e("div",{className:"items",children:_.map((g,U)=>a("div",{className:"item",onClick:()=>{p(!1),C(g),m("dm")},children:[e("div",{className:"avatar",onClick:O=>{O.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),f.fetchAndSetProfile(g.username)},children:e("img",{src:f.getAvatar(g.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[g.username,g.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:g.name})]})]},U))})]})]}):a(Y,{children:[a("div",{className:"dm-list-header",children:[a("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>m("feed")}),e("i",{className:"far fa-edit",onClick:()=>p(!0)})]}),e(Ae,{placeholder:n("SEARCH"),onChange:g=>M(g.target.value)})]}),e("div",{className:"dm-list-body",onScroll:R,children:e("div",{className:"items",children:G.length>0&&!S?_.map((g,U)=>{var O;return((O=g.content)==null?void 0:O.length)===0&&(g.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",onClick:()=>{p(!1),C(g),m("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),f.fetchAndSetProfile(g.username)},children:e("img",{src:f.getAvatar(g.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[g.name,g.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),a("div",{className:"last-message",children:[g.content.length>40?g.content.substring(0,40)+"...":g.content," • ",le(g.timestamp)]})]})]},U)}):T.map((g,U)=>{let O=U===T.length-1;return g.content.length===0&&(g.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",id:O?"last":"",onClick:()=>{p(!1),C(g),m("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),f.fetchAndSetProfile(g.username)},children:e("img",{src:f.getAvatar(g.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[g.name,g.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),g.content.length>40?g.content.substring(0,40)+"...":g.content," • ",le(g.timestamp)]})]},U)})})})]})})}function St(){var w,R,g,U;const{Account:i,View:f,Func:E,Stories:o,Story:A,Dm:d}=s.useContext(X),[m]=i,[u,P]=f,[C,l]=o,[t,S]=A,[p,G]=d,[h,I]=s.useState(0),[M,_]=s.useState(""),[F,T]=s.useState(!1),[k,y]=s.useState({x:0,y:0});s.useEffect(()=>{if(t){y(t.origin);for(let O=0;O<t.media.length;O++)if(!t.media[O].seen)return I(O)}},[]);const D=O=>{if(F)return T(!1);const $=O.target.getBoundingClientRect(),q=O.clientX-$.left*he();let K=t.media[h];if(K.seen||N("Instagram",{action:"viewedStory",id:K.id}),q<$.width*he()/2)if(h>0)I(h-1);else{let b=C.findIndex(Q=>Q.username===t.username),B=C[b-1];B&&E.fetchAndSetStory(B)}else if(h<t.media.length-1)I(h+1);else{let b=C.findIndex(Q=>Q.username===t.username),B=C[b+1];B?(r(t.username),E.fetchAndSetStory(B),I(0)):c()}},x=()=>{!M||M===""||N("Instagram",{action:"sendMessage",username:t.username,message:{content:M}}).then(O=>{O&&(G({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),P("dm"),c())})},r=O=>{t.media.length===h+1&&l($=>$.map(q=>(q.username===O&&(q.seen=1),q)))},c=O=>{O!==!1&&r(t.username),S(null)};return a(Se.div,{className:"instagram-story",initial:{scale:0,transformOrigin:t!=null&&t.origin?`${((w=t==null?void 0:t.origin)==null?void 0:w.x)??0}px ${((R=t==null?void 0:t.origin)==null?void 0:R.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:t!=null&&t.origin?`${((g=t==null?void 0:t.origin)==null?void 0:g.x)??0}px ${((U=t==null?void 0:t.origin)==null?void 0:U.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:k?`${(k==null?void 0:k.x)??0}px ${(k==null?void 0:k.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[ae(t==null?void 0:t.media[h].image)?e("video",{className:"background-image",onClick:D,autoPlay:!0,loop:!0,src:t==null?void 0:t.media[h].image}):e("div",{className:"background-image",onClick:D,style:{backgroundImage:`url(${t==null?void 0:t.media[h].image})`}}),e(ve,{children:F&&e(Nt,{activeImage:h,close:()=>T(!1)})}),a("div",{className:"story-wrapper",children:[a("div",{className:"story-header",children:[e("div",{className:"story-steps",children:t==null?void 0:t.media.map((O,$)=>e("div",{className:h===$?"active":"",onClick:()=>I($)},$))}),a("div",{className:"profile-details",children:[a("div",{className:"profile",onClick:()=>{t!=null&&t.media[h].seen||N("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[h].id}).then(O=>c()),c(),E.fetchAndSetProfile(t.username)},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar(t==null?void 0:t.avatar)})`}}),a("div",{className:"name",children:[t==null?void 0:t.username,!1]}),e("div",{className:"time",children:le(t==null?void 0:t.media[h].timestamp)})]}),e("div",{className:"stats",children:e(re,{onClick:()=>{if(t!=null&&t.media[h].seen)return c();N("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[h].id}).then(O=>c())}})})]})]}),(t==null?void 0:t.username)===m.username?a("div",{className:"story-footer","data-stats":!0,children:[a("div",{className:"seen-by",onClick:()=>T(!0),children:[(t==null?void 0:t.media[h].viewers)&&e("div",{className:"images",children:t==null?void 0:t.media[h].viewers.map((O,$)=>e("img",{src:E.getAvatar(O.avatar)},$))}),n("APPS.INSTAGRAM.SEEN_BY").format({count:Ze(t==null?void 0:t.media[h].views)??0})]}),e(re,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:n("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"removeFromStory",id:t==null?void 0:t.media[h].id}).then(O=>{if(!O)return H("error","Failed to remove image from story");H("info","Removed image from story"),S(null),t.media.length===1&&l($=>$.filter(q=>q.username!==t.username))})}}]})}})]}):a("div",{className:"story-footer",children:[e("div",{className:"input",children:e(te,{type:"text",placeholder:n("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:O=>_(O.target.value),onKeyDown:O=>{O.key==="Enter"&&x()}})}),e(Ye,{onClick:()=>x()})]})]})]})}const Nt=i=>{var G;const{Func:f,Story:E}=s.useContext(X),[o,A]=E,[d,m]=s.useState([]),[u,P]=s.useState(0),[C,l]=s.useState(!1),[t,S]=s.useState(!1);s.useEffect(()=>{(i==null?void 0:i.activeImage)!==void 0&&N("Instagram",{action:"getViewers",id:o==null?void 0:o.media[i.activeImage].id,page:0}).then(h=>{h&&(m(h),h.length<15&&l(!0))})},[]);const p=h=>{if(C||t)return;let I=document.querySelector("#last");if(!I)return;!ne(I)&&(S(!0),N("Instagram",{action:"getViewers",id:o==null?void 0:o.media[i.activeImage].id,page:u+1}).then(_=>{_&&_.length>0?(m(F=>[...F,..._]),S(!1),_.length<15&&l(!0)):l(!0)}),P(_=>_+1))};return a(Se.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[a("div",{className:"views",children:[e(ze,{})," ",e("div",{className:"views",children:((G=o==null?void 0:o.media[i==null?void 0:i.activeImage])==null?void 0:G.views)??0})]}),e(re,{className:"close",onClick:i==null?void 0:i.close})]}),a("div",{className:"story-modal-content",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:p,children:d.map((h,I)=>{let M=I===d.length-1?"last":"";return e("div",{className:"item",id:M,children:a("div",{className:"user",onClick:()=>{f.fetchAndSetProfile(h.username),A(null)},children:[e("div",{className:"profile-picture",children:e("img",{src:f.getAvatar(h.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[h.username,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:h.name})]})]})},I)})})]})]})};function At(){var u;const{Func:i,View:f,Account:E}=s.useContext(X),o=se(oe.Settings),[A,d]=f,[m]=E;return e("div",{className:"instagram-footer",children:a(Y,{children:[e("svg",{color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("feed"),children:e("g",{children:A=="feed"?e("path",{fill:o.display.theme=="dark"&&"#fafafa",d:"M22 23h-6.001a1 1 0 01-1-1v-5.455a2.997 2.997 0 10-5.993 0V22a1 1 0 01-1 1H2a1 1 0 01-1-1V11.543a1.002 1.002 0 01.31-.724l10-9.543a1.001 1.001 0 011.38 0l10 9.543a1.002 1.002 0 01.31.724V22a1 1 0 01-1 1z"}):e("path",{d:"M9.005 16.545a2.997 2.997 0 012.997-2.997h0A2.997 2.997 0 0115 16.545V22h7V11.543L12 2 2 11.543V22h7.005z",fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2"})})}),e("svg",{color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("search"),children:A=="search"?e("path",{fill:o.display.theme=="dark"&&"#fafafa",d:"M13.173 13.164l1.491-3.829-3.83 1.49zM12.001.5a11.5 11.5 0 1011.5 11.5A11.513 11.513 0 0012.001.5zm5.35 7.443l-2.478 6.369a1 1 0 01-.57.569l-6.36 2.47a1 1 0 01-1.294-1.294l2.48-6.369a1 1 0 01.57-.569l6.359-2.47a1 1 0 011.294 1.294z"}):a(Y,{children:[e("polygon",{fill:"none",points:"13.941 13.953 7.581 16.424 10.06 10.056 16.42 7.585 13.941 13.953",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}),e("polygon",{fillRule:"evenodd",points:"10.06 10.056 13.949 13.945 7.581 16.424 10.06 10.056"}),e("circle",{cx:"12.001",cy:"12.005",fill:"none",r:"10.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"})]})}),e("svg",{color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("newPost"),children:a(Y,{children:[e("path",{d:"M2 12v3.45c0 2.849.698 4.005 1.606 4.944.94.909 2.098 1.608 4.946 1.608h6.896c2.848 0 4.006-.7 4.946-1.608C21.302 19.455 22 18.3 22 15.45V8.552c0-2.849-.698-4.006-1.606-4.945C19.454 2.7 18.296 2 15.448 2H8.552c-2.848 0-4.006.699-4.946 1.607C2.698 4.547 2 5.703 2 8.552z",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}),e("line",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",x1:"6.545",x2:"17.455",y1:"12.001",y2:"12.001"}),e("line",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",x1:"12.003",x2:"12.003",y1:"6.545",y2:"17.455"})]})}),A==="notifications"?e("svg",{fill:"#262626",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{fill:o.display.theme=="dark"&&"#fafafa",d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})}):e("svg",{color:((u=o==null?void 0:o.display)==null?void 0:u.theme)==="dark"?"#ffffff":"#262626",fill:o.display.theme==="dark"?"#ffffff":"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("notifications"),children:e("path",{color:o.display.theme=="dark"&&"#fafafa",d:"M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"})}),e("img",{src:i.getAvatar(m.avatar),className:"profile",alt:"profile",onClick:()=>i.fetchAndSetProfile(m.username)})]})})}function pt(){const{Account:i,UserPanel:f,GoBack:E}=s.useContext(X),[o,A]=f,[d,m]=s.useState([]),[u,P]=s.useState(0),[C,l]=s.useState(!1),[t,S]=s.useState(!1);let p={[n("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[n("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[n("APPS.INSTAGRAM.LIKED_BY")]:"getLikes"};s.useEffect(()=>{N("Instagram",{action:p[o.data.title],data:{postId:o.data.postId,username:o.data.username,page:0}}).then(h=>{h&&m(h)})},[]);const G=()=>{if(C||t)return;!ne(document.querySelector("#last"))&&(S(!0),N("Instagram",{action:p[o.data.title],data:{postId:o.data.postId,username:o.data.username,page:u+1}}).then(I=>{I&&I.length>0?(m([...d,...I]),S(!1)):l(!0)}),P(I=>I+1))};return e(Y,{children:o.data&&d&&a("div",{className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{var h;(h=o.data)==null||h.cb()}}),e("div",{className:"userpanel-title",children:o.data.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:G,children:e("div",{className:"items",children:d.map((h,I)=>{let M=I===d.length-1;return e(It,{data:h,allData:o.data,last:M},I)})})})]})})}const It=i=>{const{Func:f,Account:E,GoBack:o,UserPanel:A}=s.useContext(X),[d]=E,[m,u]=o,[P,C]=A;let l=i.data,t=i.last;const[S,p]=s.useState(l.isFollowing===1);return a("div",{className:"item",id:t?"last":"",onClick:()=>{u({cb:()=>{C({display:!0,data:i.allData})}}),f.fetchAndSetProfile(l.username)},children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",children:e("img",{src:f.getAvatar(l.avatar),alt:"profile"})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:l.name})]})]}),d.username!==l.username&&e("div",{className:"action",onClick:G=>{G.stopPropagation(),l.username!==d.username&&(S?z.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:l.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"toggleFollow",data:{username:l.username,following:!S}}).then(()=>{p(h=>!h)})}}]}):N("Instagram",{action:"toggleFollow",data:{username:l.username,following:!S}}).then(()=>{p(h=>!h)}))},children:S?e("div",{className:"button following",children:n("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:n("APPS.INSTAGRAM.FOLLOW")})})]})},X=s.createContext(null);function Mt(){const{Func:i}=s.useContext(Xe),f=se(oe.Settings),E=se(oe.App),[o,A]=i.TextColor,[d,m]=s.useState("feed"),[u,P]=s.useState(null),[C,l]=s.useState(!1),[t,S]=s.useState([]),[p,G]=s.useState(null),[h,I]=s.useState(null),[M,_]=s.useState(null),[F,T]=s.useState(null),[k,y]=s.useState(null),[D,x]=s.useState(null),[r,c]=s.useState({display:!1,data:null}),[w,R]=s.useState(!0);s.useEffect(()=>{var b;E&&(E==null?void 0:E.view)==="profile"&&U((b=E==null?void 0:E.data)==null?void 0:b.username)},[E]),s.useEffect(()=>{N("isAdmin").then(b=>{if(ie.APPS.INSTAGRAM.account.value){P({...ie.APPS.INSTAGRAM.account.value,isAdmin:b}),l(!0),R(!1);return}else if(ie.APPS.INSTAGRAM.account.value===!1)return R(!1);N("Instagram",{action:"isLoggedIn"}).then(B=>{B?(ie.APPS.INSTAGRAM.account.set(B),P({...B,isAdmin:b}),l(!0),R(!1)):(R(!1),ie.APPS.INSTAGRAM.account.set(null))})})},[]),s.useEffect(()=>(setTimeout(()=>{d==="live"||d==="newPost"||d==="story"?(A("#fafafaed"),d=="live"&&z.IndicatorVisible.set(!1)):(A(f.display.theme==="dark"?"#fafafaed":"#000000"),z.IndicatorVisible.set(!0)),d==="dm"?me.ReceiveAppNotifications.set(!1):me.ReceiveAppNotifications.set(!0)},250),()=>{me.ReceiveAppNotifications.set(!0)}),[d]);const g=(b,B)=>{b&&N("Instagram",{action:"getPost",id:b}).then(Q=>{if(Q){if(B)return O(Q);y(Q),m("post")}})},U=b=>{b&&N("Instagram",{action:"getProfile",username:b}).then(B=>{B&&(I(B),m("profile"))})},O=b=>{b.id&&N("Instagram",{action:"getComments",postId:b.id,page:0}).then(B=>{B&&(T({post:b,comments:B}),m("comments"))})},$=(b,B,Q)=>{!b&&!(b!=null&&b.username)||((B==null?void 0:B.length)==0&&(B=void 0),N("Instagram",{action:"getStory",username:b.username}).then(ce=>{ce&&G({username:b.username,avatar:b.avatar,verified:b.verified,media:ce,queue:B,origin:Q})}))},q=b=>b||"./assets/img/icons/instagram/unknown-pfp.jpg",K={feed:e(it,{}),search:e(dt,{}),notifications:e(rt,{}),profile:e(ot,{}),live:e(et,{}),logIn:e(Re,{}),comments:e(mt,{}),post:e(gt,{}),newPost:e(ft,{}),userpanel:e(pt,{}),dmList:e(Pt,{}),dm:e(vt,{})};return s.useEffect(()=>{r.display&&m("userpanel")},[r]),e("div",{className:"instagram-container",children:e(X.Provider,{value:{View:[d,m],Account:[u,P],Profile:[h,I],Post:[k,y],Comments:[F,T],LoggedIn:[C,l],GoBack:[D,x],UserPanel:[r,c],Dm:[M,_],Stories:[t,S],Story:[p,G],Func:{fetchAndSetProfile:U,fetchAndSetStory:$,fetchAndSetComments:O,fetchAndSetPost:g,getAvatar:q}},children:w||f.airplaneMode?e("div",{className:"loading",children:e(Ke,{size:40,lineWeight:5,speed:2,color:o})}):e("div",{className:"instagram-wrapper",children:C?a(Y,{children:[e(ve,{children:p&&e(St,{})}),K[d],d!=="live"&&d!=="logIn"&&d!=="newPost"&&d!=="comments"&&!p&&e(At,{})]}):e(Re,{})})})})}export{X as InstagramContext,Mt as default};
