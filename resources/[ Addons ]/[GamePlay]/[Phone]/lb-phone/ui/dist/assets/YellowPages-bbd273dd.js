import{r as n,a as i,j as t}from"./jsx-runtime-f40812bf.js";import{b as L,f as P,u as j,x as M,L as s,ak as v,a1 as V,C as E,a3 as $,X as q,k as O,ae as X,h as f,G as H,c as C}from"./Phone-4e9b2e8a.js";import{f as K}from"./number-28525126.js";function Q(){const Y=L(C.Settings),g=L(C.PhoneNumber),w=L(f),[T,b]=n.useState(!1),[o,d]=n.useState([]),[p,m]=n.useState(!1),[a,h]=n.useState(null),[G,R]=n.useState(0),[I,S]=n.useState(!1),[W,A]=n.useState(!1),[u,k]=n.useState(""),[N,x]=n.useState(""),[y,D]=n.useState([]);n.useEffect(()=>{const e=setTimeout(()=>k(N),500);return()=>clearTimeout(e)},[N]),n.useEffect(()=>{u.length>0&&P("YellowPages",{action:"search",query:u}).then(e=>{e&&D(e)})},[u]),n.useEffect(()=>{P("YellowPages",{action:"getPosts",page:0}).then(e=>{e&&e.length>0?(d(e),e.length<10&&S(!0)):S(!0)}),P("isAdmin").then(e=>b(e))},[]);const U=()=>{if(!(a!=null&&a.title)||!(a!=null&&a.description)){let l;switch(!0){case!(a!=null&&a.title):l=s("APPS.YELLOWPAGES.ERROR_POPUP.NO_TITLE");break;case!(a!=null&&a.description):l=s("APPS.YELLOWPAGES.ERROR_POPUP.NO_DESCRIPTION");break}E.PopUp.set({title:s("APPS.YELLOWPAGES.ERROR_POPUP.TITLE"),description:l,buttons:[{title:s("APPS.YELLOWPAGES.ERROR_POPUP.OK")}]});return}let e={...a,number:g};P("YellowPages",{action:"sendPost",data:e}).then(l=>{l&&(d([{...e,id:l},...o]),m(!1))})},_=e=>{e&&E.PopUp.set({title:s("APPS.YELLOWPAGES.DELETE_POPUP.TITLE"),description:s("APPS.YELLOWPAGES.DELETE_POPUP.TEXT"),buttons:[{title:s("APPS.YELLOWPAGES.DELETE_POPUP.CANCEL")},{title:s("APPS.YELLOWPAGES.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{P("YellowPages",{action:"deletePost",id:e}).then(l=>{l&&d(o.filter(c=>c.id!==e))})}}]})},F=e=>{if(I||W)return;let l=document.querySelector("#last");if(!l)return;!H(l)&&(A(!0),P("YellowPages",{action:"getPosts",page:G+1}).then(r=>{r&&r.length>0?(d([...o,...r]),A(!1)):S(!0)}),R(r=>r+1))};return j("yellowPages:newPost",e=>{Y.airplaneMode||d([e,...o])}),n.useEffect(()=>{h(null)},[p]),i("div",{className:"pages-container",children:[t("div",{className:"pages-header",children:t(M,{theme:"light",placeholder:s("APPS.YELLOWPAGES.SEARCH"),onChange:e=>x(e.target.value)})}),t("div",{className:"add",onClick:()=>m(!0),children:t(v,{})}),t("div",{className:"pages-wrapper",children:t("div",{className:"posts",onScroll:F,children:(u.length>0?y:o).map((e,l)=>{let c=l===o.length-1?"last":"";return i("div",{className:"post",id:c,children:[i("div",{className:"post-header",children:[s("APPS.YELLOWPAGES.FROM")," ",V(e.number)]}),i("div",{className:"post-content",children:[i("div",{className:"info",children:[t("div",{className:"title",children:e.title}),t("div",{className:"description",children:e.description})]}),e.attachment&&t("div",{className:"image",onClick:()=>{E.FullscreenImage.set({display:!0,image:e.attachment})},children:t($,{src:e.attachment})})]}),i("div",{className:"post-footer",children:[e.price?t("div",{className:"price",children:w.CurrencyFormat.replace("%s",K(e.price))}):t("div",{}),i("div",{className:"buttons",children:[t("div",{className:"button",onClick:()=>{window.postMessage({data:{number:e.number,popUp:!0},action:"phone:contact"})},children:s("APPS.YELLOWPAGES.CALL")}),(g===e.number||T)&&t("div",{className:"button red",onClick:()=>_(e.id),children:t(q,{})})]})]})]},l)})})}),p&&i("div",{className:"new-post-container",children:[i("div",{className:"new-post-header",children:[t("div",{className:"cancel",onClick:()=>m(!1),children:s("APPS.YELLOWPAGES.CANCEL")}),t("div",{className:"title",children:s("APPS.YELLOWPAGES.NEW_POST")}),t("div",{})]}),i("div",{className:"new-post-body",children:[i("div",{className:"item",children:[t("div",{className:"title",children:s("APPS.YELLOWPAGES.TITLE")}),t(O,{type:"text",placeholder:s("APPS.YELLOWPAGES.TITLE"),maxLength:50,onChange:e=>h({...a,title:e.target.value})})]}),i("div",{className:"item",children:[t("div",{className:"title",children:s("APPS.YELLOWPAGES.DESCRIPTION")}),t(X,{type:"text",placeholder:s("APPS.YELLOWPAGES.DESCRIPTION"),maxLength:250,rows:5,onChange:e=>h({...a,description:e.target.value})})]}),t("div",{className:"item",children:t("div",{className:"image",style:{backgroundImage:`url(${a==null?void 0:a.attachment})`},onClick:()=>{var e,l,c;E.Gallery.set({allowExternal:(c=(l=(e=f)==null?void 0:e.value)==null?void 0:l.AllowExternal)==null?void 0:c.YellowPages,onSelect:r=>h({...a,attachment:r.src})})},children:t(v,{})})}),i("div",{className:"item",children:[t("div",{className:"title",children:s("APPS.YELLOWPAGES.PRICE")}),t(O,{type:"number",placeholder:"0",onChange:e=>{if(!e.target.value.match(/^[0-9]*$/))return e.preventDefault();h({...a,price:!isNaN(parseFloat(e.target.value))&&parseFloat(e.target.value)})}})]}),t("div",{className:"button",onClick:()=>U(),children:s("APPS.YELLOWPAGES.POST")})]})]})]})}export{Q as default};
