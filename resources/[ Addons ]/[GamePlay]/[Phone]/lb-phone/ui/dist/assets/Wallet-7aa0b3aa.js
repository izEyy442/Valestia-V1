import{r as t,a as n,j as a,F as S}from"./jsx-runtime-f40812bf.js";import{b,f as P,u as x,d as T,H as R,J as U,a5 as B,L as l,C as F,k as y,n as g,aL as $,a4 as X,c as D,h as k}from"./Phone-4e9b2e8a.js";import{r as v,f as C}from"./number-28525126.js";import{N as j}from"./Numpad-cc7ba39c.js";function q(){const h=b(D.Settings),c=b(k),[r,E]=t.useState({balance:0,transactions:[],bills:[]}),[N,d]=t.useState(!1),[_,I]=t.useState(""),[i,p]=t.useState(0),[W,A]=t.useState(!1),[s,o]=t.useState(""),[f,m]=t.useState(null);t.useEffect(()=>{P("Wallet",{action:"getData"}).then(e=>{e&&E(e)})},[]),t.useEffect(()=>{o(""),p(0)},[N]),x("wallet:addTransaction",e=>{h.airplaneMode||E({...r,balance:r.balance+e.amount,transactions:[e,...r.transactions].slice(0,5)})}),t.useEffect(()=>{i===0?s.length>3?A(!0):A(!1):i===1&&(s.length>0&&L(parseFloat(s))&&parseFloat(s)<=(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER)?A(!0):A(!1))},[s]);const L=e=>(T("info",`Can afford? ${r.balance>=e} Balance: ${r.balance}, amount: ${e}`),r.balance>=e),w=e=>{if(e=="backspace")return o(u=>u.length>0?u.slice(0,-1):"0");o(u=>u+e)};return t.useEffect(()=>{if(i!==1||s.length>=9)return;const e=document.getElementById("number");e.style.width=`${s.length}ch`,f&&m(null)},[s]),t.useEffect(()=>{m(null)},[i]),n("div",{className:"wallet-app-container",children:[a(R,{children:N&&n(U.div,{...B,className:"send-container",children:[n("div",{className:"send-header",children:[a("div",{onClick:()=>d(!1),children:l("CANCEL")}),i===2?a("div",{onClick:()=>d(!1),children:l("APPS.WALLET.DONE")}):a("div",{className:!W&&"disabled",onClick:()=>{if(W){if(i==0)P("Wallet",{action:"doesNumberExist",number:s}).then(e=>{e?(I(s),p(1),o("")):m(l("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))});else if(i==1){if(console.log(L(parseFloat(s))),!L(parseFloat(s)))return m(l("APPS.WALLET.NOT_ENOUGH_MONEY"));if(parseFloat(s)>(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return m("Max transfer amount reached");if(h.airplaneMode){F.PopUp.set({title:l("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:l("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:l("MISC.AIRPLANE_MODE_POPUP.OK")}]});return}P("Wallet",{action:"sendPayment",number:_,amount:Math.floor(parseFloat(s))}).then(e=>{e!=null&&e.success?p(2):(T("warning","not success",e.reason),m(e.reason))})}}},children:l("APPS.WALLET.NEXT")})]}),n("div",{className:"send-wrapper",children:[i===0&&n(S,{children:[a("div",{className:"user",children:a(y,{className:"number_input",type:"number",onChange:e=>o(e.target.value.replace(/[^0-9]/g,"")),value:s,placeholder:g("1234567890")})}),a("div",{className:"button",onClick:()=>{F.ContactSelector.set({onSelect:e=>{if(!(e!=null&&e.number))return T("warning","No contact found");P("Wallet",{action:"doesNumberExist",number:e.number}).then(u=>{u?(I(e.number),p(1),o("")):m(l("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))})}})},children:l("APPS.WALLET.SELECT_CONTACT")}),a("div",{className:"description",children:l("APPS.WALLET.NO_REFUNDS")}),f&&a("div",{className:"error",children:f})]}),i===1&&n(S,{children:[n("div",{className:"amount",children:[a("div",{className:"symbol",children:c.CurrencyFormat.replace("%s","")}),a(y,{type:"number",id:"number",value:s,onChange:e=>o(e.target.value.replace(/[^0-9]/g,""))})]}),n("div",{className:"description",children:[l("APPS.WALLET.NEW_BALANCE"),": ",c.CurrencyFormat.replace("%s",""),isNaN(v(r.balance-parseFloat(s),2))?r.balance:v(r.balance-parseFloat(s),2)]}),f&&a("div",{className:"error",children:f})]}),i===2&&n("div",{className:"success",children:[a($,{}),a("div",{className:"title",children:l("APPS.WALLET.DONE")}),a("div",{className:"subtitle",children:l("APPS.WALLET.DONE_SUBTITLE").format({amount:c.CurrencyFormat.replace("%s",s),number:g(_)})})]})]}),i!==2&&a("div",{className:"numpad-wrapper",children:a(j,{cb:e=>w(e)})})]})}),n("div",{className:"overview",children:[a("div",{className:"header-title",children:l("APPS.WALLET.TITLE")}),n("div",{className:"wrapper",children:[a("div",{className:"card"}),a("section",{children:n("div",{className:"item space",children:[n("div",{className:"balance",children:[a("div",{className:"title",children:l("APPS.WALLET.BALANCE")}),a(G,{amount:r.balance})]}),a("div",{className:"button",onClick:()=>d(!0),children:l("APPS.WALLET.SEND")})]})}),r.transactions&&r.transactions.length>0&&n(S,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:l("APPS.WALLET.LATEST_TRANSACTIONS")})}),a("section",{children:r.transactions.map((e,u)=>{let O=e.amount>0,M=e.company.match(/\d{10}/);return n("div",{className:"item multi",children:[e.logo?a("img",{src:e.logo}):!M&&a("div",{className:"image",children:e.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-header",children:[a("div",{className:"title",children:M?g(e.company):e.company}),a("div",{className:"right",children:n("div",{className:`amount ${O?"green":"red"}`,children:[!O&&"-",c.CurrencyFormat.replace("%s",C(Math.abs(e.amount)))]})})]}),a("div",{className:"date",children:X(e.timestamp)})]})]})})})]}),r.bills&&r.bills.length>0&&n(S,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:l("APPS.WALLET.LATEST_BILLS")})}),a("section",{})]})]})]})]})}const G=({amount:h})=>{const c=b(k),[r,E]=t.useState(!0),N=b(D.Settings);let d;return r&&(N!=null&&N.streamerMode)?d=C(parseInt("⁎".repeat(v(h,2).toString().length))):d=C(v(h,2)),a("div",{className:"value",onClick:()=>E(!r),children:c.CurrencyFormat.replace("%s",d)})};export{q as default};
