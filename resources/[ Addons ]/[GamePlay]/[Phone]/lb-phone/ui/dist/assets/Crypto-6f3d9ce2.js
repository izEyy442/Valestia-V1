import{r as u,a as S,j as r}from"./jsx-runtime-f40812bf.js";import{H as _,J as f,b as U,f as y,d as N,u as w,L as t,bw as I,bx as x,x as B,by as F,bz as k,C as h,h as Y,c as D,n as $}from"./Phone-4e9b2e8a.js";import{f as g,r as T}from"./number-28525126.js";function H({children:e,text:o}){const[m,O]=u.useState(!1);return S("div",{className:"tooltip-wrapper",onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:[e,r(_,{children:m&&r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:r("div",{dangerouslySetInnerHTML:{__html:o}})})})]})}const b=u.createContext(null);function V(){var P;const e=U(Y),o=U(D.Settings),[m,O]=u.useState(0),[C,E]=u.useState([]),[R,s]=u.useState(""),[c,A]=u.useState("0"),[l,n]=u.useState(o==null?void 0:o.streamerMode);u.useEffect(()=>{y("Crypto",{action:"get"}).then(i=>{if(!i)return N("warning","No data received from Crypto NUI event");E(i)})},[]),w("crypto:updateCoins",i=>{if(!i)return N("warning","No data received from the update Crypto NUI event");E(i)}),u.useEffect(()=>O(C.reduce((i,d)=>i+(d.owned??0)*d.current_price,0)),[C]),u.useEffect(()=>{A(l?g("âˆ—".repeat(T(m,2).toString().length)):g(T(m,2)))},[m,l]);const a=i=>{let d={0:50,10:45,12:40,14:35},p=0;for(let v=0;v<Object.keys(d).length;v++)i.length>=parseInt(Object.keys(d)[v])&&(p=d[Object.keys(d)[v]]);return p};return S("div",{className:"crypto-container",children:[S("div",{className:"crypto-header",children:[r("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),t("APPS.CRYPTO.TITLE")]}),r(b.Provider,{value:{Coins:[C,E]},children:S("div",{className:"crypto-wrapper",children:[S("div",{className:"balance",children:[S("div",{className:"title",children:[t("APPS.CRYPTO.BALANCE"),r("div",{className:"icon",onClick:()=>n(!l),children:l?r(I,{}):r(x,{})})]}),r("div",{className:"amount",style:{fontSize:a(c.toString())},onClick:()=>n(!l),children:(P=e==null?void 0:e.CurrencyFormat)==null?void 0:P.replace("%s",c.toString())})]}),r("div",{className:"search",children:r(B,{placeholder:"Search Cryptocurrency",onChange:i=>s(i.target.value)})}),r(j,{search:R}),r("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const j=({search:e})=>{const[o,m]=u.useState("balance"),[O,C]=u.useState(!0),E=["Name","Graph","Balance"],[R]=u.useContext(b).Coins;return r("div",{className:"holdings",children:S("div",{className:"items",children:[r("div",{className:"item filters",children:E.map((s,c)=>S("div",{className:"filter",onClick:()=>{if(m(s.toLowerCase()),o===s.toLowerCase())return C(!O);C(!0)},children:[s,s.toLowerCase()===o&&O?r(F,{}):r(k,{})]},c))}),R.sort((s,c)=>o==="name"?O?s.name.localeCompare(c.name):c.name.localeCompare(s.name):o==="graph"?O?s.change_24h-c.change_24h:c.change_24h-s.change_24h:o==="balance"?O?(c.owned??0)*c.current_price-(s.owned??0)*s.current_price:(s.owned??0)*s.current_price-(c.owned??0)*c.current_price:0).filter(s=>s.name.toLowerCase().includes(e.toLowerCase())||s.symbol.toLowerCase().includes(e.toLowerCase())).map((s,c)=>r(M,{data:s},c))]})})},M=({data:e})=>{const[o,m]=u.useState(!1),[O,C]=u.useState(""),[E,R]=u.useContext(b).Coins,s=(l,n)=>{n>1?y("Crypto",{action:"buy",coin:l,amount:n}).then(a=>{if(a!=null&&a.success)return R(P=>P.map(i=>i.id===l?{...i,owned:(i.owned??0)+n/i.current_price,value:(i.value??0)+n,invested:(i.invested??0)+n}:i));a!=null&&a.msg&&setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${a.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.BUY").toLowerCase(),currency:Y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},c=(l,n,a)=>{a>0?y("Crypto",{action:"sell",coin:l,amount:a}).then(P=>{if(P!=null&&P.success)return R(i=>i.map(d=>d.id===l?{...d,owned:(d.owned??0)-n/d.current_price,value:(d.value??0)+n,invested:(d.invested??0)-n}:d));P!=null&&P.msg&&setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${P.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.SELL").toLowerCase(),currency:Y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},A=(l,n,a,P)=>{a>0?y("Crypto",{action:"transfer",coin:l,amount:a,number:P}).then(i=>{i!=null&&i.success&&setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:n,coin:e.symbol,number:$(P)}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]}),R(d=>d.map(p=>p.id===l?{...p,owned:(p.owned??0)-n/p.current_price,value:(p.value??0)+n,invested:(p.invested??0)-n}:p))},250),i!=null&&i.msg&&setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${i.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{h.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:Y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),S("div",{className:"item",onClick:()=>m(!o),children:[S("div",{className:"top",children:[S("div",{className:"info",children:[r("img",{src:e.image,className:"icon",alt:"Icon"}),S("div",{className:"coin",children:[r("div",{className:"name",children:e.symbol}),r("div",{className:"symbol",children:e.name})]})]}),r(z,{data:e}),S("div",{className:"amount",children:[r("div",{className:"value",children:g(T(e.owned,4))}),S("div",{className:"asset",children:["$",g(T(e.value,2))]})]})]}),r(_,{children:o&&S(f.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:l=>{l.stopPropagation(),h.PopUp.set({title:t("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>C(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{C(n=>(s(e.id,parseFloat(n)),n))}}]})},children:t("APPS.CRYPTO.BUY")}),r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:l=>{l.stopPropagation(),h.PopUp.set({title:t("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>C(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{C(n=>{let a=parseFloat(n),P=a/e.current_price;return c(e.id,a,P),n})}}]})},children:t("APPS.CRYPTO.SELL")}),r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:l=>{l.stopPropagation(),h.PopUp.set({title:t("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>C(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{C(n=>{let a=parseFloat(n),P=a/e.current_price;return h.ContactSelector.set({onSelect:i=>{if(!i)return N("warning","No contact selected? Cancelling request");A(e.id,a,P,i.number)}}),n})}}]})},children:t("APPS.CRYPTO.TRANSFER")}),r(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:l=>{l.stopPropagation(),h.PopUp.set({title:t("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let n=e.owned*e.current_price;c(e.id,n,e.owned)}}]})},children:t("APPS.CRYPTO.SELL_ALL")})]})})]})},z=e=>{if(!(e!=null&&e.data.prices))return null;let o=e.data.prices;const m=u.useRef(null),[O,C]=u.useState(null),[E,R]=u.useState(null);return o=o.slice(0,24),u.useEffect(()=>{if(!(m!=null&&m.current))return;const s=m.current;s.width=150,s.height=100;const c=s.getContext("2d");c.lineWidth=3;const A=Math.min(...o),n=Math.max(...o)-A,a=s.height-10;let P=0,i=s.height-5-(o[0]-A)/n*a;c.beginPath(),c.moveTo(P,i);const d=o[o.length-1]-o[0]>0?"green":"red";c.strokeStyle=d;for(let L=1;L<o.length;L++)P+=s.width/(o.length-1),i=s.height-5-(o[L]-A)/n*a,c.lineTo(P,i);c.stroke();const p=(o[o.length-1]-o[0])/o[0]*100;p>0?C(`<div style="color: var(--phone-color-green)">+${T(p,2)}%</div>`):p<0?C(`<div style="color: var(--phone-color-red)">${T(p,2)}%</div>`):C(`<div>${T(p,2)}%</div>`);let v=(e.data.value-e.data.invested)/e.data.invested*100;v>0?R(`<div style="color: var(--phone-color-green)">+${T(v,2)}%</div>`):v<0&&R(`<div style="color: var(--phone-color-red)">${T(v,2)}%</div>`)},[m,o]),r(H,{text:`$${T(e.data.current_price,2)} ${O??""} ${E??""}`,children:r("canvas",{ref:m})})};export{V as default};
